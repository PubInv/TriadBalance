!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).triadb=t()}}(function(){var t={};Object.defineProperty(t,"__esModule",{value:!0});var e=function(t){return function e(){for(var a=arguments.length,n=Array(a),r=0;r<a;r++)n[r]=arguments[r];return n.length>=t.length?t.apply(void 0,n):function(){for(var t=arguments.length,a=Array(t),r=0;r<t;r++)a[r]=arguments[r];return e.apply(void 0,n.concat(a))}}},a=e(function(t,e){return[t[0]+e[0],t[1]+e[1]]}),n=e(function(t,e,a){return[t[0]+e[0]+a[0],t[1]+e[1]+a[1]]}),r=function(t){return t.reduce(a,[0,0])},i=e(function(t,e){return[t[0]-e[0],t[1]-e[1]]}),l=e(function(t,e,a){return[t[0]-e[0]-a[0],t[1]-e[1]-a[1]]}),u=function(t){return t.slice(1).reduce(i,t.slice(0,1)[0])},c=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])},o=function(t){return[-t[1],t[0]]},s=e(function(t,e){return[e[0]*t,e[1]*t]}),_=e(function(t,e,n){var r=i(n,e),l=c(r)*t;return a(e,s(l,b(r)))}),d=e(function(t,e,a){return _(a,t,e)}),f=e(function(t,e,a){return Math.abs(e-a)<t}),A=e(function(t,e,a){return f(t,e[0],a[0])&&f(t,e[1],a[1])}),h=e(function(t,e,a){var n=U.mag(a);return n<t?U.scale(t/n,a):n>e?U.scale(e/n,a):a}),b=function(t){var e=c(t);return[t[0]/e,t[1]/e]},v=Object.freeze([1,0,0,0,1,0,0,0,1]),T=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return[t,a,arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,e,n,arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,0,0,1]},N=e(function(t,e){return[e[0]*t[0]+e[1]*t[1]+t[2],e[0]*t[3]+e[1]*t[4]+t[5]]}),R=e(function(t,e){return[t[0]*e[0]+t[1]*e[3]+t[2]*e[6],t[0]*e[1]+t[1]*e[4]+t[2]*e[7],t[0]*e[2]+t[1]*e[5]+t[2]*e[8],t[3]*e[0]+t[4]*e[3]+t[5]*e[6],t[3]*e[1]+t[4]*e[4]+t[5]*e[7],t[3]*e[2]+t[4]*e[5]+t[5]*e[8],t[6]*e[0]+t[7]*e[3]+t[8]*e[6],t[6]*e[1]+t[7]*e[4]+t[8]*e[7],t[6]*e[2]+t[7]*e[5]+t[8]*e[8]]}),E=function(t){return R([Math.cos(t),-Math.sin(t),0,Math.sin(t),Math.cos(t),0,0,0,1])},S=function(t){return R([1,0,t[0],0,1,t[1],0,0,1])},g=function(t){return R([t[0],0,0,0,t[1],0,0,0,1])},L=function(t){return R([1,t[0],0,t[1],1,0,0,0,1])},m=e(function(t,e){return[e[0]*Math.cos(t)-e[1]*Math.sin(t),e[0]*Math.sin(t)+e[1]*Math.cos(t)]}),I=e(function(t,e,n){var r=i(n,e);return a(e,[r[0]*Math.cos(t)-r[1]*Math.sin(t),r[0]*Math.sin(t)+r[1]*Math.cos(t)])}),p=e(function(t,e){return s(.5,a(t,e))}),C=function(t){return[Math.cos(t),Math.sin(t)]},O=e(function(t,e,n){return function(){for(var t=arguments.length,e=Array(t),a=0;a<t;a++)e[a]=arguments[a];return function(t){for(var e=arguments.length,a=Array(e>1?e-1:0),n=1;n<e;n++)a[n-1]=arguments[n];return function(){return a.reduce(function(t,e){return e(t)},t.apply(void 0,arguments))}}.apply(void 0,function(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)}(e.reverse()))}(a(n),s(e),C)(t)}),M=e(function(t,e){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)}),D=e(function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}),G=e(function(t,e){return t[0]*e[0]+t[1]*e[1]}),y=e(function(t,e){return t[0]*e[1]-t[1]*e[0]}),w=e(function(t,e,a){return((e[0]-t[0])*(a[1]-t[1])-(a[0]-t[0])*(e[1]-t[1]))/2}),B=e(function(t,e,a){return f(1e-4,w(t,e,a),0)}),P=function(t){return t[0]*t[4]-t[3]*t[1]},U={add:a,add3:n,addAll:r,sub:i,sub3:l,subAll:u,mag:c,normal:o,scale:s,towards:_,lerp:d,scalarNear:f,near:A,clampMag:h,norm:b,mId:v,createMatrix:T,transform:N,mCompose:R,mRotate:E,mTranslate:S,mScale:g,mShear:L,rotate:m,rotatePointAround:I,midpoint:p,angle:C,alongAngle:O,fastDist:M,dist:D,dot:G,perpdot:y,triangleArea:w,colinear:B,det:P};t.default=U,t.vec=U,t.vAdd=a,t.vAdd3=n,t.vAddAll=r,t.vSub=i,t.vSub3=l,t.vSubAll=u,t.vMag=c,t.vNormal=o,t.vScale=s,t.vTowards=_,t.vLerp=d,t.vScalarNear=f,t.vNear=A,t.vClampMag=h,t.vNorm=b,t.mId=v,t.vCreateMatrix=T,t.vTransform=N,t.mCompose=R,t.mRotate=E,t.mTranslate=S,t.mScale=g,t.mShear=L,t.vRotate=m,t.vRotatePointAround=I,t.vMidpoint=p,t.vAngle=C,t.vAlongAngle=O,t.vFastDist=M,t.vDist=D,t.vDot=G,t.vPerpDot=y,t.vTriangleArea=w,t.vColinear=B,t.vDet=P;var W=t.vec;let H=function(t,e){return[t*e[0],t*e[1],t*e[2]]};var x={add:function(t,e){return[t[0]+e[0],t[1]+e[1],t[2]+e[2]]},sub:function(t,e){return[t[0]-e[0],t[1]-e[1],t[2]-e[2]]},manhattan:function(t,e){return Math.abs(t[0]-e[0])+Math.abs(t[1]-e[1])+Math.abs(t[2]-e[2])},dist:function(t,e){return Math.sqrt((t[0]-e[0])**2+(t[1]-e[1])**2+(t[2]-e[2])**2)},mag:function(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2)},scale:H,normalize:function(t){return H(1/x.mag(t),t)}};const V=Math.sqrt(3);function q(t,e,a,n){const r=W.norm(e),i=W.sub(t,a),l=W.sub(n,a),u=[-r[1],r[0]],c=W.dot(l,u);if(W.scalarNear(1e-5,c,0))return null;const o=W.perpdot(l,i)/c,s=W.dot(i,u)/c;return o>=0&&s>=0&&s<=1?[W.add(t,W.scale(o,r)),o]:null}function z(t){return x.manhattan([0,0,0],t)}function Y(t){return x.mag(t)}var F=[function(t){return x.normalize(t)},Y];function K(t,e){if(W.scalarNear(1e-5,e[0],0))return W.scalarNear(1e-5,e[1],0)?[]:e[1]>0?[1,2]:[0];{let t=e[1]/e[0],a=-V/3,n=V/3;if(e[0]>0&&W.scalarNear(1e-5,t,a))return[0,1];if(e[0]>0&&t>a)return[1];if(e[0]>0&&t<a)return[0];if(e[0]<0&&W.scalarNear(1e-5,t,n))return[0,2];if(e[0]<0&&t<n)return[2];if(e[0]<0&&t>n)return[0]}}function Z(t,e){let a=K(0,e);if(0==a.length)return null;if(2==a.length){if(0==a[0]&&1==a[1])return t[1];if(0==a[0]&&2==a[1])return t[0];if(1==a[0]&&2==a[1])return t[2]}else{let n=e[0],r=e[1],i=W.dist(t[0],t[1]),l=i*V/6;if(W.scalarNear(1e-5,n,0))return r>0?t[2]:[0,-l];let u=r/n;if(0==a[0])return[-l/u,-l];if(1==a[0]){let t=i/(3*(1/V+1/u));return[t/u,t]}if(2==a[0]){let t=i/(3*(1/V-1/u));return[t/u,t]}}}var $,j={TriadBalance2to3:function(t,e,a=F){let n=a[0];if(W.scalarNear(1e-5,W.mag(t),0))return n([1,1,1]);let[r,i]=function(t,e){if(function(t){let e=W.dist(t[0],t[1]),a=W.dist(t[1],t[2]),n=W.dist(t[2],t[0]);return W.near(1e-5,[0,0],function(t){return W.scale(t.length,W.addAll(t))}(t))&&0==t[2][0]&&t[2][1]>0&&W.scalarNear(1e-5,e,a)&&W.scalarNear(1e-5,a,n)&&W.scalarNear(1e-5,n,a)}(t))return[K(0,e)[0],Z(t,e)];for(var a,n=-1,r=0;r<3&&n<0;r++){var i=q([0,0],e,t[r],t[(r+1)%3]);null!=i&&(n=r,a=i[0])}return[n,a]}(e,t);const l=W.dist([0,0],i),u=W.clampMag(0,l,t);var c=W.dist(u,i)/l;let o=x.scale(c,n([1,1,1]));const s=W.dist(e[r],i),_=W.dist(e[(r+1)%3],i);let d=[0,0,0];d[r]=_,d[(r+1)%3]=s;let f=x.scale(1-c,n(d));return x.add(f,o)},invertTriadBalance2to3:function(t,e,a=F){let n=a[1],r=Math.min(Math.min(t[0],t[1]),t[2]),i=[t[0]-r,t[1]-r,t[2]-r],l=x.sub(t,i),u=n(i);var c,o,s;n(l);let _=i[0]+i[1]+i[2];0==i[0]?(c=e[2],o=e[1],s=i[1]/_):0==i[1]?(c=e[0],o=e[2],s=i[2]/_):0==i[2]&&(c=e[1],o=e[0],s=i[0]/_);const d=W.lerp(c,o,s);return W.lerp([0,0],d,u)},eqPointOnEdgeAlgebraically:Z,eqEdgeAlgebraically:K,GetRayToLineSegmentIntersection:q,L1LENGTH:z,L2LENGTH:Y,L1:[function(t){let e=x.manhattan([0,0,0],t);return x.scale(1/e,t)},z],L2:F};function k(t,e,a=.7){let n=e.getClientRects()[0],r=n.width,i=n.height,l=Math.min(r,i)*a;const u=l*(Math.sqrt(3)/2),c=-1/3*u,o=t?1:-1;return[[-l/2,c*o],[l/2,c*o],[0,(c+u)*o]]}function X(t){return-t}function J(t){return t}function Q(t,e){if(e){!function(t){for(var e=document.getElementsByClassName("triad-marker"),a=e.length-1;a>=0;a--)e[a].parentNode.removeChild(e[a])}();let a=j.invertTriadBalance2to3(e,t.triad_balance_state.TRIAD_WORLD_TRIANGLE,t.triad_balance_state.NORM_TO_USE),n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttributeNS(null,"cx",J(a[0])),n.setAttributeNS(null,"cy",X(a[1])),n.setAttributeNS(null,"r",3),n.setAttributeNS(null,"class","triad-marker"),n.ISMARKER=!0,t.appendChild(n)}}function tt(t,e){let a=t.triad_balance_state.H*e;function n(t,e,n,r,i,l,u){var c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttributeNS(null,"x",r),c.setAttributeNS(null,"y",i),c.setAttributeNS(null,"dy",l),c.setAttributeNS(null,"font-size",a),c.setAttributeNS(null,"class",n),c.setAttributeNS(null,"id",e),c.appendChild(document.createTextNode(u)),t.appendChild(c)}for(;t.lastChild;)t.removeChild(t.lastChild);var r=document.createElementNS("http://www.w3.org/2000/svg","polygon");r.setAttributeNS(null,"id","triad-balance-triangle"),t.appendChild(r);for(let u=0;u<3;u++){var i=t.createSVGPoint();i.x=J(t.triad_balance_state.TRIAD_WORLD_TRIANGLE[u][0]),i.y=X(t.triad_balance_state.TRIAD_WORLD_TRIANGLE[u][1]),r.points.appendItem(i)}!function(t,e,a,r){let i=[r+4,r+4,-(r/2+4)];for(let l=0;l<3;l++)n(t,"triad-vertex-label-"+l,"triad-vertices-labels",J(t.triad_balance_state.TRIAD_WORLD_TRIANGLE[l][0]),X(t.triad_balance_state.TRIAD_WORLD_TRIANGLE[l][1]),t.triad_balance_state.POINTS_UPWARD?i[l]:r/2-i[l],a[l])}(t,t.triad_balance_state.TRIAD_WORLD_TRIANGLE,t.triad_balance_state.LABELS,a);let l=document.createElementNS("http://www.w3.org/2000/svg","circle");l.setAttributeNS(null,"cx",J(0)),l.setAttributeNS(null,"cy",X(0)),l.setAttributeNS(null,"r",2),l.setAttributeNS(null,"id","triangle_origin"),t.appendChild(l)}return $={vec:t,m:j,initialize_triad_diagram:function(t){function e(e){let a=t.SVG_ELT.getClientRects()[0],n=a.width,r=a.height;e.triad_balance_state.W=n,e.triad_balance_state.H=r;let i=e.triad_balance_state.Whalf,l=e.triad_balance_state.Hhalf;e.triad_balance_state.TRIAD_WORLD_TRIANGLE=k(e.triad_balance_state.POINTS_UPWARD,e,e.triad_balance_state.SIDE_TO_MIN_BOUND);let u=e.triad_balance_state.POINTS_UPWARD?e.triad_balance_state.Y_DISP_PER_CENT:-e.triad_balance_state.Y_DISP_PER_CENT;e.setAttribute("viewBox",`-${i} -${l+r*u/100} ${n} ${r}`),tt(t.SVG_ELT,e.triad_balance_state.FONT_SIZE_RATIO_TO_HEIGHT),Q(t.SVG_ELT,e.triad_balance_state.CUR_BALANCE)}t.SVG_ELT.triad_balance_state=t,e(t.SVG_ELT),t.SVG_ELT.addEventListener("click",e=>(function(t,e,a,n,r){var i=a.getBoundingClientRect(),l=t.clientX-i.left,u=t.clientY-i.top,c=l+-a.triad_balance_state.Whalf;let o=a.triad_balance_state.POINTS_UPWARD?a.triad_balance_state.Y_DISP_PER_CENT:-a.triad_balance_state.Y_DISP_PER_CENT;var s=-(u+-a.triad_balance_state.Hhalf+-a.triad_balance_state.H*o/100);a.triad_balance_state.CUR_TRIANGLE_COORDS=[c,s],a.triad_balance_state.CUR_BALANCE=j.TriadBalance2to3(a.triad_balance_state.CUR_TRIANGLE_COORDS,a.triad_balance_state.TRIAD_WORLD_TRIANGLE,a.triad_balance_state.NORM_TO_USE);var _=j.invertTriadBalance2to3(a.triad_balance_state.CUR_BALANCE,a.triad_balance_state.TRIAD_WORLD_TRIANGLE,a.triad_balance_state.NORM_TO_USE);Q(a,a.triad_balance_state.CUR_BALANCE),r(a.triad_balance_state.CUR_TRIANGLE_COORDS,_,a.triad_balance_state.CUR_BALANCE)})(e,t.SVG_ELT.triad_balance_state.FONT_SIZE_RATIO_TO_HEIGHT,t.SVG_ELT,t.LABELS,t.CLICK_CALLBACK)),window.addEventListener("resize",a=>{e(t.SVG_ELT)})},get_triangle:k,TriadBalanceState:class{constructor(t,e,a,n,r,i,l,u,c=j.L1,o=.7,s=.05,_=10,d=!0){this.SVG_ELT=t,this.CLICK_CALLBACK=e,this.LABELS=a,this.TRIAD_WORLD_TRIANGLE=n,this.W=r,this.H=i,this.CUR_BALANCE=l,this.CUR_TRIANGLE_COORDS=u,this.NORM_TO_USE=c,this.FONT_SIZE_RATIO_TO_HEIGHT=s,this.Y_DISP_PER_CENT=_,this.POINTS_UPWARD=d,this.SIDE_TO_MIN_BOUND=o}get Hhalf(){return this.H/2}get Whalf(){return this.W/2}},set_norm_to_use:function(t,e){t.triad_balance_state.NORM_TO_USE=e},set_labels:function(t,e){t.triad_balance_state.LABELS=e,tt(t,t.triad_balance_state.FONT_SIZE_RATIO_TO_HEIGHT),Q(t,t.triad_balance_state.CUR_BALANCE)},TriadBalance2to3:j.TriadBalance2to3,invertTriadBalance2to3:j.invertTriadBalance2to3},console.log(t),$});